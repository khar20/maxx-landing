---
import Language from './icons/Language.astro';

const LANGUAGES = ['Español', 'English'];
---

<div class="relative mx-1">
	<button
		transition:persist
		id="lang-toggle-btn"
		class="flex appearance-none border-none transition hover:scale-110"
	>
		<span class="sr-only">Elige el idioma</span>
		<div class="flex items-center gap-2">
			<Language class="size-6" />
			<span class="text-sm">Español</span>
		</div>
	</button>
	<div
		transition:persist
		id="langs-menu"
		class="absolute top-8 right-0 hidden min-w-[8rem] rounded-md border border-gray-100 bg-white/90 p-1 text-sm shadow-[0_3px_10px_rgb(0,0,0,0.2)] backdrop-blur-md dark:border-gray-500/20 dark:bg-gray-900/90"
	>
		<ul>
			{
				LANGUAGES.map((language) => (
					<li class="langs-menu-option cursor-default rounded-sm px-2 py-1.5 hover:bg-neutral-400/40 dark:hover:bg-gray-500/50">
						{language}
					</li>
				))
			}
		</ul>
	</div>
</div>

<style>
	#langs-menu.open {
		display: inline;
		animation: scale-up-center 0.15s cubic-bezier(0.25, 0.46, 0.45, 0.94)
			both;
	}

	@keyframes scale-up-center {
		from {
			transform: scale(0.8);
			opacity: 0;
		}
		to {
			transform: scale(1);
			opacity: 1;
		}
	}
</style>

<script is:inline>
	// Referencia al menú de idiomas
	const langsMenu = document.getElementById('langs-menu');

	// Función para actualizar la visualización del idioma seleccionado
	const updateLanguage = () => {
		// Recupera el idioma guardado o usa "español" por defecto
		const language = localStorage.getItem('language') || 'español';
		// Actualiza el texto del botón para reflejar el idioma actual
		document.querySelector('#lang-toggle-btn span.text-sm').innerText =
			language.charAt(0).toUpperCase() + language.slice(1);
	};

	// Inicializa el idioma en carga de página
	updateLanguage();

	// Cierra el menú al hacer clic fuera
	document.addEventListener('click', () => {
		langsMenu.classList.remove('open');
	});

	// Muestra u oculta el menú cuando se hace clic en el botón
	document
		.getElementById('lang-toggle-btn')
		.addEventListener('click', (e) => {
			e.stopPropagation();
			langsMenu.classList.toggle('open');
		});

	// Al seleccionar un idioma, se guarda en localStorage y se actualiza la UI
	document.querySelectorAll('.langs-menu-option').forEach((element) => {
		element.addEventListener('click', (e) => {
			const selectedLanguage = e.target.innerText.toLowerCase().trim();
			localStorage.setItem('language', selectedLanguage);
			updateLanguage();
			langsMenu.classList.remove('open'); // Opcional: cerrar el menú
		});
	});
</script>
